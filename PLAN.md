# План реализации функций кнопок

## Обзор проекта
Приложение для генерации описаний картин, названий выставок и афиш с использованием AI.

## Порядок действий

### 1. Настройка AI API
- [x] Выбрать AI провайдера (OpenAI GPT-4 Vision / Anthropic Claude / Google Gemini)
- [x] Установить необходимые пакеты (например, `openai` или `@anthropic-ai/sdk`)
- [x] Создать файл `.env.local` для хранения API ключей
- [x] Добавить переменные окружения в `.env.local`:
  - `AI_API_KEY` - ключ API
  - `AI_MODEL` - модель для использования (опционально)

**Выполнено:**
- Выбран провайдер: **OpenRouter AI** (универсальный API для доступа к различным моделям AI)
- Используется нативный `fetch` API (не требуется дополнительных пакетов)
- Endpoint: `https://openrouter.ai/api/v1/chat/completions`
- Создан файл `env.example` с примером конфигурации
- Создана утилита `lib/openrouter.ts` для работы с OpenRouter API
- `.gitignore` уже содержит `.env*.local` для защиты ключей
- **Важно:** Создайте файл `.env.local` вручную на основе `env.example` и добавьте свой API ключ OpenRouter

### 2. Создание API Routes в Next.js

#### 2.1. API Route для генерации описаний (`/api/describe`)
- [ ] Создать файл `app/api/describe/route.ts`
- [ ] Реализовать обработку POST запроса
- [ ] Получить загруженные изображения из FormData
- [ ] Конвертировать изображения в base64 или передать в API
- [ ] Для каждой картинки:
  - Отправить запрос к AI API с промптом для генерации описания
  - Получить описание картины
- [ ] Вернуть массив описаний в формате JSON
- [ ] Добавить обработку ошибок

#### 2.2. API Route для генерации названий выставки (`/api/exhibition`)
- [ ] Создать файл `app/api/exhibition/route.ts`
- [ ] Реализовать обработку POST запроса
- [ ] Получить описания картин (из предыдущего шага или сгенерировать заново)
- [ ] Отправить совокупный анализ всех описаний к AI API
- [ ] Запросить 3 варианта названия выставки
- [ ] Вернуть массив из 3 вариантов названий
- [ ] Добавить обработку ошибок

#### 2.3. API Route для генерации афиши (`/api/poster`)
- [ ] Создать файл `app/api/poster/route.ts`
- [ ] Реализовать обработку POST запроса
- [ ] Получить выбранное название выставки
- [ ] Получить изображения картин
- [ ] Отправить запрос к AI API для:
  - Генерации макета афиши (текстовое описание или изображение)
  - Генерации краткого описания выставки
- [ ] Вернуть объект с макетом афиши и описанием
- [ ] Добавить обработку ошибок

### 3. Обновление фронтенда

#### 3.1. Функция "Описание" (кнопка "Описание")
- [ ] Обновить `handleDescription` в `app/page.tsx`
- [ ] Создать FormData с загруженными изображениями
- [ ] Отправить POST запрос к `/api/describe`
- [ ] Отобразить загрузку во время запроса
- [ ] Получить массив описаний
- [ ] Отформатировать и отобразить описания в блоке результатов
- [ ] Сохранить описания в state для использования в следующих шагах
- [ ] Добавить обработку ошибок с уведомлением пользователя

#### 3.2. Функция "Выставка" (кнопка "Выставка")
- [ ] Обновить `handleExhibition` в `app/page.tsx`
- [ ] Проверить наличие описаний картин (если нет - сначала сгенерировать)
- [ ] Отправить POST запрос к `/api/exhibition` с описаниями
- [ ] Отобразить загрузку во время запроса
- [ ] Получить 3 варианта названий
- [ ] Отобразить варианты как кликабельные кнопки
- [ ] Реализовать выбор варианта с визуальным выделением
- [ ] Сохранить выбранный вариант в state
- [ ] Добавить обработку ошибок

#### 3.3. Функция "Афиша" (кнопка "Афиша")
- [ ] Обновить `handlePoster` в `app/page.tsx`
- [ ] Проверить наличие выбранного названия выставки
- [ ] Создать FormData с изображениями и выбранным названием
- [ ] Отправить POST запрос к `/api/poster`
- [ ] Отобразить загрузку во время запроса
- [ ] Получить макет афиши и описание
- [ ] Отобразить макет афиши (если это изображение - показать, если текст - отформатировать)
- [ ] Отобразить краткое описание выставки
- [ ] Добавить обработку ошибок

### 4. Улучшение UX

#### 4.1. Обработка состояний
- [ ] Добавить состояние для хранения описаний картин
- [ ] Добавить состояние для отслеживания прогресса генерации
- [ ] Улучшить индикаторы загрузки (прогресс-бар, процент выполнения)
- [ ] Добавить возможность отмены запросов

#### 4.2. Валидация
- [ ] Проверка формата изображений (только изображения)
- [ ] Проверка размера файлов (ограничение размера)
- [ ] Проверка количества файлов (максимальное количество)
- [ ] Валидация перед отправкой запросов

#### 4.3. Обработка ошибок
- [ ] Понятные сообщения об ошибках для пользователя
- [ ] Retry механизм для неудачных запросов
- [ ] Логирование ошибок для отладки
- [ ] Обработка таймаутов

### 5. Оптимизация и производительность

#### 5.1. Оптимизация изображений
- [ ] Сжатие изображений перед отправкой
- [ ] Ресайз изображений до разумного размера
- [ ] Кэширование результатов генерации

#### 5.2. Оптимизация запросов
- [ ] Параллельная обработка описаний картин (если API поддерживает)
- [ ] Батчинг запросов
- [ ] Дебаунсинг для предотвращения множественных кликов

### 6. Тестирование

- [ ] Протестировать загрузку различных форматов изображений
- [ ] Протестировать генерацию описаний для разных картин
- [ ] Протестировать генерацию названий выставки
- [ ] Протестировать генерацию афиши
- [ ] Протестировать обработку ошибок
- [ ] Протестировать граничные случаи (много картин, большие файлы)

### 7. Документация

- [ ] Обновить README.md с инструкциями по настройке API ключей
- [ ] Добавить комментарии в код
- [ ] Документировать структуру API endpoints
- [ ] Добавить примеры использования

## Технические детали

### Структура данных

#### Описание картины
```typescript
interface PaintingDescription {
  imageName: string;
  description: string;
}
```

#### Варианты названия выставки
```typescript
interface ExhibitionOption {
  id: number;
  title: string;
}
```

#### Результат генерации афиши
```typescript
interface PosterResult {
  poster: string; // URL изображения или описание макета
  description: string; // Краткое описание выставки
}
```

### Промпты для AI

#### Промпт для описания картины
```
Проанализируй эту картину и создай подробное описание:
- Стиль и техника
- Сюжет и композиция
- Цветовая палитра
- Художественные особенности
```

#### Промпт для названия выставки
```
На основе следующих описаний картин предложи 3 варианта названия для выставки:
[описания картин]

Каждое название должно быть:
- Кратким и запоминающимся
- Отражать общую тематику выставки
- Подходить для художественной выставки
```

#### Промпт для афиши
```
Создай макет афиши для выставки с названием: "[название]"

Включи:
- Визуальное описание макета
- Краткое описание выставки (2-3 предложения)
- Ключевые элементы для дизайна
```

## Приоритеты реализации

1. **Высокий приоритет**: API routes и базовая функциональность кнопок
2. **Средний приоритет**: Обработка ошибок и валидация
3. **Низкий приоритет**: Оптимизация и улучшение UX
